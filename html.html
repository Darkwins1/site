<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cardápio e Pedidos</title>
    <style>
        /* ==================== */
        /* Variáveis CSS */
        /* ==================== */
        :root {
            --cor-primaria: #8a2be2;
            --cor-secundaria: #7b1fa2;
            --cor-fundo: #0a0a0a;
            --cor-texto: #e0e0e0;
            --cor-destaque: #ffffff;
            --sombra-neon: 0 0 5px rgba(138, 43, 226, 0.5), 0 0 10px rgba(138, 43, 226, 0.5);
        }

        /* ==================== */
        /* Reset e Estilos Globais */
        /* ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--cor-fundo);
            color: var(--cor-texto);
            line-height: 1.6;
            padding: 20px;
        }

        /* ==================== */
        /* Cabeçalhos e Títulos */
        /* ==================== */
        h1, h2 {
            color: var(--cor-destaque);
            margin-bottom: 20px;
            text-shadow: var(--sombra-neon);
        }

        h1 {
            font-size: 2.5rem;
            text-align: center;
        }

        h2 {
            font-size: 2rem;
            margin-top: 30px;
        }

        /* ==================== */
        /* Contêineres e Layouts */
        /* ==================== */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            border-radius: 15px;
            box-shadow: var(--sombra-neon);
        }

        .form-container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #2a2a2a;
            border-radius: 10px;
            box-shadow: var(--sombra-neon);
        }

        .form-container h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .form-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--cor-destaque);
        }

        .form-container input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #555;
            border-radius: 5px;
            font-size: 1rem;
            background-color: #3a3a3a;
            color: var(--cor-texto);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-container input:focus {
            border-color: var(--cor-primaria);
            outline: none;
            box-shadow: var(--sombra-neon);
        }

        .form-container button {
            width: 100%;
            background-color: var(--cor-primaria);
            color: var(--cor-fundo);
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: var(--sombra-neon);
        }

        .form-container button:hover {
            background-color: var(--cor-secundaria);
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.8);
        }

        .form-container p {
            text-align: center;
            margin-top: 15px;
        }

        .form-container a {
            color: var(--cor-primaria);
            text-decoration: none;
            font-weight: bold;
        }

        .form-container a:hover {
            text-decoration: underline;
        }

        /* ==================== */
        /* Cardápio */
        /* ==================== */
        .cardapio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .prato-card {
            background-color: #2a2a2a;
            padding: 15px;
            border-radius: 10px;
            box-shadow: var(--sombra-neon);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
        }

        .prato-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.8);
        }

        .prato-card p {
            margin: 5px 0;
            color: var(--cor-texto);
        }

        .prato-card strong {
            color: var(--cor-primaria);
            text-shadow: var(--sombra-neon);
        }

        /* ==================== */
        /* Pedidos */
        /* ==================== */
        .pedido-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .itens-pedido {
            flex: 1;
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--sombra-neon);
        }

        .itens-pedido .item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #3a3a3a;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(138, 43, 226, 0.3);
        }

        .itens-pedido .item p {
            margin: 0;
            color: var(--cor-texto);
        }

        .itens-pedido .item button {
            background-color: var(--cor-primaria);
            color: var(--cor-fundo);
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: var(--sombra-neon);
        }

        .itens-pedido .item button:hover {
            background-color: var(--cor-secundaria);
            box-shadow: 0 0 10px rgba(138, 43, 226, 0.8);
        }

        .pedidos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .pedido-card {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--sombra-neon);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .pedido-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.8);
        }

        .pedido-card p {
            margin: 5px 0;
            color: var(--cor-texto);
        }

        .pedido-card strong {
            color: var(--cor-primaria);
            text-shadow: var(--sombra-neon);
        }

        .pedido-card button {
            background-color: var(--cor-primaria);
            color: var(--cor-fundo);
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: var(--sombra-neon);
            margin-top: 10px;
        }

        .pedido-card button:hover {
            background-color: var(--cor-secundaria);
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.8);
        }

        /* ==================== */
        /* Formulários */
        /* ==================== */
        #pedidoForm {
            flex: 1;
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--sombra-neon);
        }

        #pedidoForm label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--cor-destaque);
        }

        #pedidoForm input,
        #pedidoForm select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #555;
            border-radius: 5px;
            font-size: 1rem;
            background-color: #3a3a3a;
            color: var(--cor-texto);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        #pedidoForm input:focus,
        #pedidoForm select:focus {
            border-color: var(--cor-primaria);
            outline: none;
            box-shadow: var(--sombra-neon);
        }

        #pedidoForm button {
            background-color: var(--cor-primaria);
            color: var(--cor-fundo);
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: var(--sombra-neon);
        }

        #pedidoForm button:hover {
            background-color: var(--cor-secundaria);
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.8);
        }

        /* ==================== */
        /* Barra de Pesquisa */
        /* ==================== */
        .barra-pesquisa {
            margin-bottom: 20px;
            text-align: center;
        }

        #pesquisa {
            width: 80%;
            max-width: 500px;
            padding: 10px;
            border: 1px solid #555;
            border-radius: 5px;
            font-size: 1rem;
            background-color: #3a3a3a;
            color: var(--cor-texto);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        #pesquisa:focus {
            border-color: var(--cor-primaria);
            outline: none;
            box-shadow: var(--sombra-neon);
        }

        /* ==================== */
        /* Mensagens */
        /* ==================== */
        .mensagem {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 5px;
            color: var(--cor-destaque);
            z-index: 1000;
            animation: fadeIn 0.5s ease-in-out;
        }

        .mensagem.sucesso {
            background-color: #28a745;
        }

        .mensagem.erro {
            background-color: #dc3545;
        }

        /* ==================== */
        /* Ícones e Animações */
        /* ==================== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .container {
            animation: fadeIn 0.5s ease-in-out;
        }

        /* Ícones */
        i.fas {
            margin-right: 8px;
            color: var(--cor-primaria);
        }

        /* ==================== */
        /* Responsividade */
        /* ==================== */
        @media (max-width: 768px) {
            .pedido-container {
                flex-direction: column;
            }

            .cardapio-grid,
            .pedidos-grid {
                grid-template-columns: 1fr;
            }
        }
        /* Estilo para textarea */
textarea {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #555;
    border-radius: 5px;
    font-size: 1rem;
    background-color: #3a3a3a;
    color: var(--cor-texto);
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

textarea:focus {
    border-color: var(--cor-primaria);
    outline: none;
    box-shadow: var(--sombra-neon);
}

/* Estilo para select */
select {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #555;
    border-radius: 5px;
    font-size: 1rem;
    background-color: #3a3a3a;
    color: var(--cor-texto);
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

select:focus {
    border-color: var(--cor-primaria);
    outline: none;
    box-shadow: var(--sombra-neon);
}
/* Estilo base para todos os botões */
button {
    background-color: var(--cor-primaria);
    color: var(--cor-fundo);
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    box-shadow: var(--sombra-neon);
}

/* Efeito hover para todos os botões */
button:hover {
    background-color: var(--cor-secundaria);
    box-shadow: 0 0 15px rgba(138, 43, 226, 0.8);
}

/* Estilo específico para botões de formulários */
.form-container button {
    width: 100%;
    margin-top: 10px;
}

/* Estilo para textarea */
textarea {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #555;
    border-radius: 5px;
    font-size: 1rem;
    background-color: #3a3a3a;
    color: var(--cor-texto);
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

textarea:focus {
    border-color: var(--cor-primaria);
    outline: none;
    box-shadow: var(--sombra-neon);
}

/* Estilo para select */
select {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #555;
    border-radius: 5px;
    font-size: 1rem;
    background-color: #3a3a3a;
    color: var(--cor-texto);
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

select:focus {
    border-color: var(--cor-primaria);
    outline: none;
    box-shadow: var(--sombra-neon);
}
/* Estilo base para inputs de texto */
input[type="text"],
input[type="number"],
input[type="email"],
input[type="date"],
textarea {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    border: 1px solid #555;
    border-radius: 8px;
    font-size: 1rem;
    background-color: #2a2a2a;
    color: var(--cor-texto);
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    outline: none;
}

/* Efeito ao focar nos campos */
input[type="text"]:focus,
input[type="number"]:focus,
input[type="email"]:focus,
input[type="date"]:focus,
textarea:focus {
    border-color: var(--cor-primaria);
    box-shadow: 0 0 10px rgba(138, 43, 226, 0.8);
}

/* Placeholder estilizado */
input::placeholder,
textarea::placeholder {
    color: #888;
    font-style: italic;
}

/* Estilo para inputs desabilitados */
input:disabled,
textarea:disabled {
    background-color: #1a1a1a;
    color: #666;
    cursor: not-allowed;
}
    </style>
</head>
<body>
    <div class="container">
        <!-- Formulário de Login -->
        <div id="loginFormContainer" class="form-container">
            <h2>Login</h2>
            <form id="loginForm">
                <label for="email">E-mail:</label>
                <input type="email" id="email" name="email" required>

                <label for="senha">Senha:</label>
                <input type="password" id="senha" name="senha" required>

                <button type="submit">Entrar</button>
            </form>
            <p>Não tem uma conta? <a href="#" onclick="mostrarCadastro()">Cadastre-se</a></p>
        </div>

        <!-- Formulário de Cadastro -->
        <div id="cadastroFormContainer" class="form-container" style="display: none;">
            <h2>Cadastro</h2>
            <form id="cadastroForm">
                <label for="nomeCadastro">Nome:</label>
                <input type="text" id="nomeCadastro" name="nome" required>

                <label for="emailCadastro">E-mail:</label>
                <input type="email" id="emailCadastro" name="email" required>

                <label for="senhaCadastro">Senha:</label>
                <input type="password" id="senhaCadastro" name="senha" required>

                <button type="submit">Cadastrar</button>
            </form>
            <p>Já tem uma conta? <a href="#" onclick="mostrarLogin()">Faça login</a></p>
        </div>

        <!-- Conteúdo Principal (Cardápio e Pedidos) -->
        <div id="conteudoPrincipal" style="display: none;">
            <h1>Cardápio e Pedidos</h1>

            <!-- Barra de Pesquisa -->
            <div class="barra-pesquisa">
                <input type="text" id="pesquisa" placeholder="Pesquisar item..." oninput="filtrarCardapio()">
            </div>

            <!-- Cardápio -->
            <h2>Hambúrgueres</h2>
            <div id="hamburgueres" class="cardapio-grid"></div>

            <h2>Sucos</h2>
            <div id="sucos" class="cardapio-grid"></div>

            <h2>Refrigerantes</h2>
            <div id="refrigerantes" class="cardapio-grid"></div>

            <h2>Sobremesas</h2>
            <div id="sobremesas" class="cardapio-grid"></div>

            <h2>Acompanhamentos</h2>
            <div id="acompanhamentos" class="cardapio-grid"></div>

            <h2>Promoções</h2>
            <div id="promocoes" class="cardapio-grid"></div>

            <!-- Seção de Pedido -->
            <h2>Pedido</h2>
            <div class="pedido-container">
                <div id="itensPedido" class="itens-pedido"></div>
                <form id="pedidoForm">
                    <label for="mesa">Número da Mesa:</label>
                    <input type="number" id="mesa" name="mesa" required>

                    <label for="metodoPagamento">Método de Pagamento:</label>
                    <select id="metodoPagamento" name="metodoPagamento" required>
                        <option value="dinheiro">Dinheiro</option>
                        <option value="credito">Crédito</option>
                        <option value="debito">Débito</option>
                        <option value="pix">Pix</option>
                    </select>

                    <label for="valorRecebido">Valor Recebido:</label>
                    <input type="number" id="valorRecebido" name="valorRecebido" step="0.01">

                    <label for="divisao">Divisão da Conta:</label>
                    <input type="number" id="divisao" name="divisao" min="1" value="1">

                    <button type="submit">Finalizar Pedido</button>
                </form>
            </div>

            <!-- Pedidos Realizados -->
            <h2>Pedidos Realizados</h2>
            <div id="pedidos" class="pedidos-grid"></div>

            <!-- Histórico de Pedidos -->
            <h2>Histórico de Pedidos</h2>
            <div id="historico" class="historico-grid"></div>

            <!-- Nova Seção: Reserva de Mesas -->
            <h2>Reserva de Mesas</h2>
            <form id="reservaForm">
                <label for="mesaId">Número da Mesa:</label>
                <input type="number" id="mesaId" name="mesaId" required>

                <label for="clienteNome">Nome do Cliente:</label>
                <input type="text" id="clienteNome" name="clienteNome" required>

                <button type="submit">Reservar Mesa</button>
            </form>

            <!-- Nova Seção: Relatórios de Vendas -->
            <h2>Relatórios de Vendas</h2>
            <form id="relatorioForm">
                <label for="periodo">Período:</label>
                <select id="periodo" name="periodo" required>
                    <option value="diario">Diário</option>
                    <option value="semanal">Semanal</option>
                    <option value="mensal">Mensal</option>
                </select>

                <button type="submit">Gerar Relatório</button>
            </form>

            <!-- Nova Seção: Controle de Estoque -->
            <h2>Controle de Estoque</h2>
            <form id="estoqueForm">
                <label for="ingredienteId">ID do Ingrediente:</label>
                <input type="number" id="ingredienteId" name="ingredienteId" required>

                <label for="quantidade">Quantidade:</label>
                <input type="number" id="quantidade" name="quantidade" required>

                <button type="submit">Atualizar Estoque</button>
            </form>

            <!-- Nova Seção: Enviar Mensagem via WhatsApp -->
            <h2>Enviar Mensagem via WhatsApp</h2>
            <form id="whatsappForm">
                <label for="numeroWhatsApp">Número do WhatsApp:</label>
                <input type="text" id="numeroWhatsApp" name="numeroWhatsApp" required>

                <label for="mensagemWhatsApp">Mensagem:</label>
                <textarea id="mensagemWhatsApp" name="mensagemWhatsApp" required></textarea>

                <button type="submit">Enviar Mensagem</button>
            </form>

            <!-- Nova Seção: Feedback dos Clientes -->
            <h2>Feedback dos Clientes</h2>
            <form id="feedbackForm">
                <label for="pedidoIdFeedback">ID do Pedido:</label>
                <input type="number" id="pedidoIdFeedback" name="pedidoIdFeedback" required>

                <label for="notaFeedback">Nota (1 a 5):</label>
                <input type="number" id="notaFeedback" name="notaFeedback" min="1" max="5" required>

                <label for="comentarioFeedback">Comentário:</label>
                <textarea id="comentarioFeedback" name="comentarioFeedback"></textarea>

                <button type="submit">Enviar Feedback</button>
            </form>
        </div>
    </div>

    <script>
        // Função para alternar entre login e cadastro
        function mostrarCadastro() {
            document.getElementById('loginFormContainer').style.display = 'none';
            document.getElementById('cadastroFormContainer').style.display = 'block';
        }

        function mostrarLogin() {
            document.getElementById('cadastroFormContainer').style.display = 'none';
            document.getElementById('loginFormContainer').style.display = 'block';
        }

        // Função para cadastrar um novo usuário
        document.getElementById('cadastroForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const nome = document.getElementById('nomeCadastro').value;
            const email = document.getElementById('emailCadastro').value;
            const senha = document.getElementById('senhaCadastro').value;

            try {
                const response = await fetch('http://localhost:8000/cadastro', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ nome, email, senha })
                });

                if (response.ok) {
                    mostrarMensagem('Cadastro realizado com sucesso!', 'sucesso');
                    mostrarLogin(); // Volta para o formulário de login
                } else {
                    const erro = await response.json();
                    mostrarMensagem(erro.mensagem || 'Erro ao realizar o cadastro.', 'erro');
                }
            } catch (error) {
                console.error('Erro ao cadastrar:', error);
                mostrarMensagem('Erro ao cadastrar. Tente novamente.', 'erro');
            }
        });

        // Função para realizar o login
        document.getElementById('loginForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const email = document.getElementById('email').value;
            const senha = document.getElementById('senha').value;

            try {
                const response = await fetch('http://localhost:8000/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, senha })
                });

                if (response.ok) {
                    const { access_token, refresh_token, usuario } = await response.json();
                    localStorage.setItem('access_token', access_token);
                    localStorage.setItem('refresh_token', refresh_token);

                    mostrarMensagem('Login realizado com sucesso!', 'sucesso');
                    document.getElementById('loginFormContainer').style.display = 'none';
                    document.getElementById('conteudoPrincipal').style.display = 'block';
                    carregarCardapio();
                    carregarPedidos();
                    carregarHistorico();
                } else {
                    const erro = await response.json();
                    mostrarMensagem(erro.mensagem || 'Erro ao realizar o login.', 'erro');
                }
            } catch (error) {
                console.error('Erro ao fazer login:', error);
                mostrarMensagem('Erro ao fazer login. Tente novamente.', 'erro');
            }
        });

        // Função para renovar o token de acesso
        async function renovarToken() {
            const refresh_token = localStorage.getItem('refresh_token');
            if (!refresh_token) return null;

            try {
                const response = await fetch('http://localhost:8000/refresh', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${refresh_token}`
                    }
                });

                if (response.ok) {
                    const { access_token } = await response.json();
                    localStorage.setItem('access_token', access_token);
                    return access_token;
                } else {
                    localStorage.removeItem('access_token');
                    localStorage.removeItem('refresh_token');
                    mostrarMensagem('Sessão expirada. Faça login novamente.', 'erro');
                    window.location.reload();
                    return null;
                }
            } catch (error) {
                console.error('Erro ao renovar token:', error);
                return null;
            }
        }

        // Função para fazer requisições autenticadas
        async function fetchAutenticado(url, options = {}) {
            let access_token = localStorage.getItem('access_token');
            if (!access_token) {
                mostrarMensagem('Faça login para acessar esta funcionalidade.', 'erro');
                return null;
            }

            options.headers = {
                ...options.headers,
                'Authorization': `Bearer ${access_token}`
            };

            let response = await fetch(url, options);

            // Se o token expirou, tenta renovar
            if (response.status === 401) {
                access_token = await renovarToken();
                if (access_token) {
                    options.headers['Authorization'] = `Bearer ${access_token}`;
                    response = await fetch(url, options);
                }
            }

            return response;
        }

        // Função para carregar o cardápio
        async function carregarCardapio() {
            try {
                const response = await fetchAutenticado('http://localhost:8000/cardapio');
                if (!response.ok) throw new Error('Erro ao carregar cardápio.');
                const cardapio = await response.json();

                // Preenche as categorias
                preencherCategoria('hamburgueres', cardapio.hamburgueres);
                preencherCategoria('sucos', cardapio.sucos);
                preencherCategoria('refrigerantes', cardapio.refrigerantes);
                preencherCategoria('sobremesas', cardapio.sobremesas);
                preencherCategoria('acompanhamentos', cardapio.acompanhamentos);
                preencherCategoria('promocoes', cardapio.promocoes);
            } catch (error) {
                console.error('Erro ao carregar cardápio:', error);
                mostrarMensagem('Erro ao carregar cardápio. Tente novamente.', 'erro');
            }
        }

        // Função para preencher uma categoria do cardápio
        function preencherCategoria(categoriaId, itens) {
            const categoriaDiv = document.getElementById(categoriaId);
            categoriaDiv.innerHTML = '';

            itens.forEach(prato => {
                const pratoCard = document.createElement('div');
                pratoCard.className = 'prato-card';
                pratoCard.innerHTML = `
                    <p><strong>${prato.nome}</strong> - R$ ${prato.valor.toFixed(2)}</p>
                    <p>${prato.descricao}</p>
                    <p>Tempo estimado: ${prato.tempo_estimado} minutos</p>
                `;
                pratoCard.addEventListener('click', () => adicionarItemPedido(prato));
                categoriaDiv.appendChild(pratoCard);
            });
        }

        // Função para filtrar o cardápio
        function filtrarCardapio() {
            const termo = document.getElementById('pesquisa').value.toLowerCase();
            const categorias = ['hamburgueres', 'refrigerantes','sucos', 'sobremesas', 'acompanhamentos', 'promocoes'];

            categorias.forEach(categoriaId => {
                const categoriaDiv = document.getElementById(categoriaId);
                const itens = categoriaDiv.querySelectorAll('.prato-card');

                itens.forEach(item => {
                    const nome = item.querySelector('strong').textContent.toLowerCase();
                    if (nome.includes(termo)) {
                        item.style.display = 'block'; // Mostra o item
                    } else {
                        item.style.display = 'none'; // Esconde o item
                    }
                });
            });
        }

        // Função para adicionar um item ao pedido
        function adicionarItemPedido(prato) {
            const itensPedidoDiv = document.getElementById('itensPedido');

            // Verifica se o item já foi adicionado
            const itemExistente = Array.from(itensPedidoDiv.children).find(item => {
                return item.dataset.id === prato.id.toString();
            });

            if (itemExistente) {
                const quantidadeInput = itemExistente.querySelector('.quantidade');
                quantidadeInput.value = parseInt(quantidadeInput.value) + 1;
            } else {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item';
                itemDiv.dataset.id = prato.id;
                itemDiv.innerHTML = `
                    <p>${prato.nome} - R$ ${prato.valor.toFixed(2)}</p>
                    <input type="number" class="quantidade" min="1" value="1">
                    <button onclick="removerItem(this)">Remover</button>
                `;
                itensPedidoDiv.appendChild(itemDiv);
            }
        }

        // Função para remover um item do pedido
        function removerItem(botao) {
            const itemDiv = botao.parentElement;
            itemDiv.remove();
        }

        // Função para enviar o pedido
        document.getElementById('pedidoForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const mesa = document.getElementById('mesa').value;
            const metodoPagamento = document.getElementById('metodoPagamento').value;
            const valorRecebido = parseFloat(document.getElementById('valorRecebido').value);
            const divisao = parseInt(document.getElementById('divisao').value);

            if (!mesa || !metodoPagamento) {
                mostrarMensagem('Preencha todos os campos obrigatórios.', 'erro');
                return;
            }

            if (metodoPagamento === 'dinheiro' && (isNaN(valorRecebido) || valorRecebido <= 0)) {
                mostrarMensagem('Informe o valor recebido para pagamento em dinheiro.', 'erro');
                return;
            }

            if (divisao <= 0) {
                mostrarMensagem('A divisão da conta deve ser maior que zero.', 'erro');
                return;
            }

            const itens = Array.from(document.querySelectorAll('.item')).map(item => ({
                id: parseInt(item.dataset.id),
                quantidade: parseInt(item.querySelector('.quantidade').value)
            }));

            const pedido = {
                mesa,
                itens,
                pagamento: {
                    metodo: metodoPagamento,
                    valor_recebido: valorRecebido,
                    divisao
                }
            };

            try {
                const response = await fetchAutenticado('http://localhost:8000/pedido', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(pedido)
                });

                if (response.ok) {
                    mostrarMensagem('Pedido realizado com sucesso!', 'sucesso');
                    document.getElementById('itensPedido').innerHTML = ''; // Limpa os itens do pedido
                    carregarPedidos();
                } else {
                    const erro = await response.json();
                    mostrarMensagem(erro.erro || 'Erro ao realizar o pedido.', 'erro');
                }
            } catch (error) {
                console.error('Erro ao enviar pedido:', error);
                mostrarMensagem('Erro ao enviar pedido. Tente novamente.', 'erro');
            }
        });

        // Função para carregar os pedidos
        async function carregarPedidos() {
            try {
                const response = await fetchAutenticado('http://localhost:8000/pedidos');
                if (!response.ok) throw new Error('Erro ao carregar pedidos.');
                const pedidos = await response.json();

                const pedidosDiv = document.getElementById('pedidos');
                pedidosDiv.innerHTML = '';

                pedidos.forEach(pedido => {
                    const pedidoCard = document.createElement('div');
                    pedidoCard.className = 'pedido-card';
                    pedidoCard.innerHTML = `
                        <p><strong>Pedido #${pedido.id}</strong> - Mesa ${pedido.mesa}</p>
                        <p>Status: ${pedido.status}</p>
                        <p>Total: R$ ${pedido.total_com_taxa.toFixed(2)}</p>
                        <p>Tempo estimado: ${pedido.tempo_estimado} minutos</p>
                        <p>Método de pagamento: ${pedido.pagamento.metodo}</p>
                        ${pedido.pagamento.troco > 0 ? `<p>Troco: R$ ${pedido.pagamento.troco.toFixed(2)}</p>` : ''}
                        ${pedido.pagamento.divisao > 1 ? `<p>Valor por pessoa: R$ ${pedido.pagamento.valor_por_pessoa.toFixed(2)}</p>` : ''}
                        <div class="cronometro" data-horario="${pedido.horario}" data-tempo-estimado="${pedido.tempo_estimado}">
                            <p>Tempo decorrido: <span class="tempo-decorrido">00:00</span></p>
                            <p>Tempo restante: <span class="tempo-restante">${formatoTempo(Math.floor(pedido.tempo_estimado), 0)}</span></p>
                        </div>
                        ${pedido.status !== "Entregue" && pedido.status !== "Cancelado" ? `<button onclick="cancelarPedido(${pedido.id})">Cancelar Pedido</button>` : ''}
                        ${pedido.status === "Pronto para entrega" ? `<button onclick="entregarPedido(${pedido.id})">Entregar</button>` : ''}
                    `;
                    pedidosDiv.appendChild(pedidoCard);
                });

                // Inicia o cronômetro para cada pedido
                iniciarCronometros();
            } catch (error) {
                console.error('Erro ao carregar pedidos:', error);
                mostrarMensagem('Erro ao carregar pedidos. Tente novamente.', 'erro');
            }
        }

        // Função para carregar o histórico de pedidos
        async function carregarHistorico() {
            try {
                const response = await fetchAutenticado('http://localhost:8000/historico');
                if (!response.ok) throw new Error('Erro ao carregar histórico.');
                const historico = await response.json();

                const historicoDiv = document.getElementById('historico');
                historicoDiv.innerHTML = '';

                historico.forEach(pedido => {
                    const pedidoCard = document.createElement('div');
                    pedidoCard.className = 'pedido-card';
                    pedidoCard.innerHTML = `
                        <p><strong>Pedido #${pedido.id}</strong> - Mesa ${pedido.mesa}</p>
                        <p>Status: ${pedido.status}</p>
                        <p>Total: R$ ${pedido.total_com_taxa.toFixed(2)}</p>
                        <p>Método de pagamento: ${pedido.pagamento.metodo}</p>
                        ${pedido.pagamento.troco > 0 ? `<p>Troco: R$ ${pedido.pagamento.troco.toFixed(2)}</p>` : ''}
                        ${pedido.pagamento.divisao > 1 ? `<p>Valor por pessoa: R$ ${pedido.pagamento.valor_por_pessoa.toFixed(2)}</p>` : ''}
                    `;
                    historicoDiv.appendChild(pedidoCard);
                });
            } catch (error) {
                console.error('Erro ao carregar histórico:', error);
                mostrarMensagem('Erro ao carregar histórico. Tente novamente.', 'erro');
            }
        }

        // Função para entregar um pedido
        async function entregarPedido(pedidoId) {
            try {
                const response = await fetchAutenticado(`http://localhost:8000/pedido/${pedidoId}/entregar`, {
                    method: 'PUT'
                });

                if (response.ok) {
                    mostrarMensagem('Pedido entregue com sucesso!', 'sucesso');
                    carregarPedidos(); // Atualiza a lista de pedidos
                    carregarHistorico(); // Atualiza o histórico de pedidos
                } else {
                    const erro = await response.json();
                    mostrarMensagem(erro.erro || 'Erro ao entregar o pedido.', 'erro');
                }
            } catch (error) {
                console.error('Erro ao entregar pedido:', error);
                mostrarMensagem('Erro ao entregar pedido. Tente novamente.', 'erro');
            }
        }

        // Função para cancelar um pedido
        async function cancelarPedido(pedidoId) {
            try {
                const response = await fetchAutenticado(`http://localhost:8000/pedido/${pedidoId}/cancelar`, {
                    method: 'PUT'
                });

                if (response.ok) {
                    mostrarMensagem('Pedido cancelado com sucesso!', 'sucesso');
                    carregarPedidos(); // Atualiza a lista de pedidos
                    carregarHistorico(); // Atualiza o histórico de pedidos
                } else {
                    const erro = await response.json();
                    mostrarMensagem(erro.erro || 'Erro ao cancelar o pedido.', 'erro');
                }
            } catch (error) {
                console.error('Erro ao cancelar pedido:', error);
                mostrarMensagem('Erro ao cancelar pedido. Tente novamente.', 'erro');
            }
        }

        // Função para formatar o tempo no padrão MM:SS
        function formatoTempo(minutos, segundos) {
            return `${String(minutos).padStart(2, '0')}:${String(segundos).padStart(2, '0')}`;
        }

        // Função para iniciar os cronômetros
        function iniciarCronometros() {
            const cronometros = document.querySelectorAll('.cronometro');
            cronometros.forEach(cronometro => {
                const horarioPedido = new Date(cronometro.dataset.horario).getTime();
                const tempoEstimado = parseInt(cronometro.dataset.tempoEstimado) * 60000; // Converte minutos para milissegundos

                const intervalo = setInterval(() => {
                    const agora = new Date().getTime();
                    const tempoDecorrido = agora - horarioPedido;
                    const tempoRestante = tempoEstimado - tempoDecorrido;

                    // Para o cronômetro se o tempo restante for menor ou igual a zero ou se o pedido for cancelado/entregue
                    if (tempoRestante <= 0 || cronometro.closest('.pedido-card').querySelector('p').textContent.includes("Cancelado") || cronometro.closest('.pedido-card').querySelector('p').textContent.includes("Entregue")) {
                        clearInterval(intervalo);
                        cronometro.querySelector('.tempo-restante').textContent = '00:00';
                        return;
                    }

                    // Calcula minutos e segundos decorridos
                    const minutosDecorridos = Math.floor(tempoDecorrido / 60000);
                    const segundosDecorridos = Math.floor((tempoDecorrido % 60000) / 1000);

                    // Calcula minutos e segundos restantes
                    const minutosRestantes = Math.floor(tempoRestante / 60000);
                    const segundosRestantes = Math.floor((tempoRestante % 60000) / 1000);

                    // Atualiza o cronômetro
                    cronometro.querySelector('.tempo-decorrido').textContent = formatoTempo(minutosDecorridos, segundosDecorridos);
                    cronometro.querySelector('.tempo-restante').textContent = formatoTempo(minutosRestantes, segundosRestantes);
                }, 1000); // Atualiza a cada segundo
            });
        }

        // Função para mostrar mensagens
        function mostrarMensagem(mensagem, tipo = 'sucesso') {
            const mensagemDiv = document.createElement('div');
            mensagemDiv.className = `mensagem ${tipo}`;
            mensagemDiv.textContent = mensagem;
            document.body.appendChild(mensagemDiv);
            setTimeout(() => mensagemDiv.remove(), 3000);
        }

        // Verifica se o usuário já está autenticado ao carregar a página
        document.addEventListener('DOMContentLoaded', function () {
            const access_token = localStorage.getItem('access_token');
            if (access_token) {
                document.getElementById('loginFormContainer').style.display = 'none';
                document.getElementById('conteudoPrincipal').style.display = 'block';
                carregarCardapio();
                carregarPedidos();
                carregarHistorico();
                setInterval(carregarPedidos, 5000); // Atualiza os pedidos a cada 5 segundos
            }
        });

        // ==================== NOVAS FUNÇÕES ====================

        // Função para reservar mesa
        async function reservarMesa(mesaId, clienteNome) {
            const response = await fetchAutenticado('http://localhost:8000/reservar-mesa', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ mesaId, clienteNome })
            });
            if (response.ok) {
                mostrarMensagem(`Mesa ${mesaId} reservada para ${clienteNome}.`, 'sucesso');
            } else {
                mostrarMensagem('Erro ao reservar mesa.', 'erro');
            }
        }

        // Função para gerar relatório de vendas
        async function gerarRelatorioVendas(periodo) {
            const response = await fetchAutenticado(`http://localhost:8000/relatorios?periodo=${periodo}`);
            if (response.ok) {
                const relatorio = await response.json();
                console.log('Relatório de Vendas:', relatorio);
                mostrarMensagem('Relatório gerado com sucesso!', 'sucesso');
            } else {
                mostrarMensagem('Erro ao gerar relatório.', 'erro');
            }
        }

        // Função para atualizar estoque
        async function atualizarEstoque(ingredienteId, quantidade) {
            const response = await fetchAutenticado('http://localhost:8000/atualizar-estoque', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ingredienteId, quantidade })
            });
            if (response.ok) {
                mostrarMensagem('Estoque atualizado com sucesso!', 'sucesso');
            } else {
                mostrarMensagem('Erro ao atualizar estoque.', 'erro');
            }
        }
    </script>
</body>
</html>
